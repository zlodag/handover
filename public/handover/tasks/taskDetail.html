<h2>{{detail.task.getStatus()}} task</h2>
<div id="detail">
    <div class="section text" ng-class="{high: detail.task.info.urgency === 3,medium: detail.task.info.urgency === 2,low: detail.task.info.urgency === 1}">
        <p ng-bind="detail.task.info.text"></p>
    </div>
    <div class="section details">
        <h4>Details</h4>
        <dl class="meta">
    	    <dt class="patient">Patient</dt>
    	    <dd class="patient" ng-bind="detail.task.info.patient"></dd>
    	    <dt class="nhi">NHI</dt>
    	    <dd class="nhi" ng-bind="detail.task.info.nhi"></dd>
    	    <dt class="specialty">Specialty</dt>
    	    <dd class="specialty" ng-bind="detail.task.info.specialty"></dd>
    	    <dt class="location">Location</dt>
            <dd class="location"><span class="ward" ng-bind="detail.task.info.ward"></span><span class="bed" ng-bind="detail.task.info.bed"></span></dd>
      	    <dt class="urgency">Urgency</dt>
    	    <dd class="urgency" ng-bind="detail.task.info.urgency"></dd>
        </dl>
    </div>
    <div class="section events">
        <h4>Events</h4>
        <ul>
            <li class="event">
                <span class="status Added">Added</span>
                <span class="user"><a ui-sref="user({userId: detail.task.info.by})" ng-bind="users.getName(detail.task.info.by)"></a></span>
                <span class="time" ng-bind="detail.task.info.at | date : 'h:mma dd/MM/yyyy'"></span>
            </li>
            <li ng-repeat="event in detail.task.events" class="event">
                <span class="status" ng-if="event.data.status" ng-class="event.data.status" ng-bind="event.data.status"></span>
                <span class="comment" ng-if="event.data.comment" ng-bind="event.data.comment"></span>
                <span class="referral" ng-if="event.data.referral"><a ui-sref="user({userId: event.data.referral})" ng-bind="users.getName(event.data.referral)"></a></span>
                <span class="user"><a ui-sref="user({userId: event.data.by})" ng-bind="users.getName(event.data.by)"></a></span>
                <span class="time" ng-bind="event.data.at | date : 'h:mma dd/MM/yyyy'"></span>
            </li>
        </ul>
    </div>
    <div class="section forms" ng-hide="detail.task.info.Completed">
        <h4>Forms</h4>
        <div class="buttons">
            <button type="button" ng-click="detail.task.newStatus('Accepted')" ng-hide="detail.task.info.Accepted">Accept</button>
            <button type="button" ng-click="detail.task.newStatus('Completed')">Complete</button>
            <button type="button" ng-click="detail.task.newStatus('Cancelled')">Cancel</button>
        </div>
        <form ng-submit="detail.task.referTo(target)">
            <select ng-model="target" ng-options="key as users.getName(key) disable when (detail.task.events.alreadyReferred(key) || authData.uid === key) for (key, value) in users" required >
                <option value="">Refer to:</option>
            </select>
            <input type="submit" value="Refer" />
        </form>
        <form ng-submit="detail.task.addComment(newComment); newComment = ''">
            <label for="newComment">Add a new comment</label>
            <input type="text" id="newComment" ng-model="newComment" />
            <input type="submit" class="btn btn-primary" value="Post" />
        </form>
    </div>
</div>
